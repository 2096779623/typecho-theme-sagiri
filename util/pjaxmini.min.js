"use strict";function _defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function asyncGeneratorStep(e,r,t,n,a,o,i){try{var c=e[o](i),u=c.value}catch(e){return void t(e)}c.done?r(u):Promise.resolve(u).then(n,a)}function _asyncToGenerator(c){return function(){var e=this,i=arguments;return new Promise(function(r,t){var n=c.apply(e,i);function a(e){asyncGeneratorStep(n,r,t,a,o,"next",e)}function o(e){asyncGeneratorStep(n,r,t,a,o,"throw",e)}a(void 0)})}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,r){if(e){if("string"==typeof e)return _arrayLikeToArray(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(t):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,r):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),e}!function(){var e=function(){function n(e){_classCallCheck(this,n);var r={target:"a",container:"body"};for(var t in r)r.hasOwnProperty(t)&&!e.hasOwnProperty(t)&&(e[t]=r[t]);this.option=e,this.init(e)}var r;return _createClass(n,[{key:"init",value:function(o){var e=_toConsumableArray(document.querySelectorAll(o.target)),i=this;e.forEach(function(e){var a=e.href,r=document.location.origin,t=a.lastIndexOf("/"),n=a.substring(t+1,a.length);if(!a.match(r)||/#/.test(n))return null;e.onclick=function(){var r=_asyncToGenerator(regeneratorRuntime.mark(function e(r){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(r||window.event).preventDefault(),e.next=4,i.fetchData(a);case 4:return n=e.sent,t=i.parseHtml(n.data,o.body),i.replaceHeader(t.head),i.replaceContainer(o.container,t.container),i.appendScriptTobodyEnd(t.scriptWrap),i.pushState(null,null,a),e.abrupt("return",void 0);case 11:case"end":return e.stop()}},e)}));return function(e){return r.apply(this,arguments)}}()}),window.addEventListener("popstate",function(){var r=_asyncToGenerator(regeneratorRuntime.mark(function e(r){var t,n,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.target.location.href,e.next=3,i.fetchData(t);case 3:n=e.sent,a=i.parseHtml(n.data,o.body),i.replaceHeader(a.head),i.replaceContainer(o.container,a.container);case 7:case"end":return e.stop()}},e)}));return function(e){return r.apply(this,arguments)}}())}},{key:"fetchData",value:(r=_asyncToGenerator(regeneratorRuntime.mark(function e(r){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(r).then(function(e){return t=e.text()}).then(function(e){t=e}).catch(function(e){0});case 2:return e.abrupt("return",{data:t,err:void 0});case 3:case"end":return e.stop()}},e)})),function(e){return r.apply(this,arguments)})},{key:"parseHtml",value:function(e,r){document.implementation.createHTMLDocument();var t=new RegExp("(?<=<head>).*|[\\s\\S]*(?=</head>)"),n=document.createElement("div"),a=document.createElement("div");a.innerHTML=e;var o=a.querySelector(r),i=o.querySelectorAll("script");return _toConsumableArray(i).forEach(function(e){o.contains(e)&&e.parentElement.removeChild(e)}),n.innerHTML=_toConsumableArray(e.match(t)).join(),{head:n,container:o,scriptWrap:i}}},{key:"replaceHeader",value:function(e){var r=_toConsumableArray(e.children);document.head.innerHTML=null,r.map(function(e,r){document.head.append(e)})}},{key:"replaceContainer",value:function(e,t){var n=this;if("string"==typeof e){var r=document.querySelector(e),a=this.getDomAttr(r),o=t.querySelector(e);a.map(function(e){var r=Object.keys(e)[0];"class"==e[r]?o.className=e[r]:t[r]=e[r]}),r.parentElement.replaceChild(o,r)}if(Array.isArray(e)){var i=[],c=[],u=[];e.forEach(function(e){var r=document.querySelector(e);i.push(r),c.push(n.getDomAttr(r)),u.push(t.querySelector(e))}),c.forEach(function(e,t){e.forEach(function(e){var r=Object.keys(e)[0];"class"==e[r]?u[t].className=e[r]:u[t][r]=e[r]})}),i.forEach(function(e,r){e.parentElement.replaceChild(u[r],e)})}}},{key:"appendScriptTobodyEnd",value:function(e){document.querySelector(this.option.body).querySelectorAll("script").forEach(function(e){e.parentElement.removeChild(e)}),document.body.querySelectorAll("script").forEach(function(e){e.parentElement.removeChild(e)}),document.body.removeChild,_toConsumableArray(e).forEach(function(e){var r=document.createElement("script");e.getAttribute("src")?r.src=e.src:r.text=e.text,document.body.append(r)})}},{key:"pushState",value:function(e,r,t){history.pushState(e,r,t)}},{key:"getDomAttr",value:function(e){var r,t,n=[],a=e.attributes;for(r=0,t=a.length;r<t;r++)a[r].specified&&n.push(_defineProperty({},a[r].nodeName,a[r].nodeValue));return n}}]),n}();"undefined"!=typeof module&&void 0!==module.exports?module.exports=e:window.miniPjax=e}();