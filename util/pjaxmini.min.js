"use strict";function _defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function asyncGeneratorStep(e,r,t,n,a,o,i){try{var c=e[o](i),u=c.value}catch(e){return void t(e)}c.done?r(u):Promise.resolve(u).then(n,a)}function _asyncToGenerator(c){return function(){var e=this,i=arguments;return new Promise(function(r,t){var n=c.apply(e,i);function a(e){asyncGeneratorStep(n,r,t,a,o,"next",e)}function o(e){asyncGeneratorStep(n,r,t,a,o,"throw",e)}a(void 0)})}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,r){if(e){if("string"==typeof e)return _arrayLikeToArray(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(t="Object"===t&&e.constructor?e.constructor.name:t)||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,r):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),e}!function(){var e=function(){function n(e){_classCallCheck(this,n);var r,t={target:"a",container:"body"};for(r in t)t.hasOwnProperty(r)&&!e.hasOwnProperty(r)&&(e[r]=t[r]);this.option=e,this.init(e)}var r;return _createClass(n,[{key:"init",value:function(a){var e=_toConsumableArray(document.querySelectorAll(a.target)),o=this;e.forEach(function(e){var n=e.href,r=document.location.origin,t=n.lastIndexOf("/"),t=n.substring(t+1,n.length);if(!n.match(r)||/#/.test(t))return null;e.onclick=function(){var r=_asyncToGenerator(regeneratorRuntime.mark(function e(r){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(r||window.event).preventDefault(),e.next=4,o.fetchData(n);case 4:return t=e.sent,t=o.parseHtml(t.data,a.body),o.replaceHeader(t.head),o.replaceContainer(a.container,t.container),o.appendScriptTobodyEnd(t.scriptWrap),o.pushState(null,null,n),e.abrupt("return",void 0);case 11:case"end":return e.stop()}},e)}));return function(e){return r.apply(this,arguments)}}()}),window.addEventListener("popstate",function(){var r=_asyncToGenerator(regeneratorRuntime.mark(function e(r){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.target.location.href,e.next=3,o.fetchData(t);case 3:t=e.sent,t=o.parseHtml(t.data,a.body),o.replaceHeader(t.head),o.replaceContainer(a.container,t.container);case 7:case"end":return e.stop()}},e)}));return function(e){return r.apply(this,arguments)}}())}},{key:"fetchData",value:(r=_asyncToGenerator(regeneratorRuntime.mark(function e(r){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(r).then(function(e){return t=e.text()}).then(function(e){t=e}).catch(function(e){});case 2:return e.abrupt("return",{data:t,err:void 0});case 3:case"end":return e.stop()}},e)})),function(e){return r.apply(this,arguments)})},{key:"parseHtml",value:function(e,r){document.implementation.createHTMLDocument();var t=new RegExp("(?<=<head>).*|[\\s\\S]*(?=</head>)"),n=document.createElement("div"),a=document.createElement("div");a.innerHTML=e;var o=a.querySelector(r),r=o.querySelectorAll("script");return _toConsumableArray(r).forEach(function(e){o.contains(e)&&e.parentElement.removeChild(e)}),n.innerHTML=_toConsumableArray(e.match(t)).join(),{head:n,container:o,scriptWrap:r}}},{key:"replaceHeader",value:function(e){e=_toConsumableArray(e.children);document.head.innerHTML=null,e.map(function(e,r){document.head.append(e)})}},{key:"replaceContainer",value:function(e,t){var r,n,a,o,i,c,u=this;"string"==typeof e&&(r=document.querySelector(e),n=this.getDomAttr(r),a=t.querySelector(e),n.map(function(e){var r=Object.keys(e)[0];"class"==e[r]?a.className=e[r]:t[r]=e[r]}),r.parentElement.replaceChild(a,r)),Array.isArray(e)&&(o=[],i=[],c=[],e.forEach(function(e){var r=document.querySelector(e);o.push(r),i.push(u.getDomAttr(r)),c.push(t.querySelector(e))}),i.forEach(function(e,t){e.forEach(function(e){var r=Object.keys(e)[0];"class"==e[r]?c[t].className=e[r]:c[t][r]=e[r]})}),o.forEach(function(e,r){e.parentElement.replaceChild(c[r],e)}))}},{key:"appendScriptTobodyEnd",value:function(e){document.querySelector(this.option.body).querySelectorAll("script").forEach(function(e){e.parentElement.removeChild(e)}),document.body.querySelectorAll("script").forEach(function(e){e.parentElement.removeChild(e)}),document.body.removeChild,_toConsumableArray(e).forEach(function(e){var r=document.createElement("script");e.getAttribute("src")?r.src=e.src:r.text=e.text,document.body.append(r)})}},{key:"pushState",value:function(e,r,t){history.pushState(e,r,t)}},{key:"getDomAttr",value:function(e){for(var r=[],t=e.attributes,n=0,a=t.length;n<a;n++)t[n].specified&&r.push(_defineProperty({},t[n].nodeName,t[n].nodeValue));return r}}]),n}();"undefined"!=typeof module&&void 0!==module.exports?module.exports=e:window.miniPjax=e}();